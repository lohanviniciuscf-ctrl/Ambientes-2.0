<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>CRM Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#0a192f;
 --card:#112240;
 --accent:#64ffda;
 --text:#e6f1ff;
}

*{box-sizing:border-box}

body{
 margin:0;
 font-family:'Poppins',sans-serif;
 background:linear-gradient(135deg,var(--bg),#020c1b);
 color:var(--text);
}

button,input,select{
 padding:10px;
 border:none;
 border-radius:10px;
 font-family:'Poppins';
 width:100%;
 margin-bottom:10px;
}

button{
 cursor:pointer;
 font-weight:600;
 background:var(--accent);
 color:#000;
 transition:.3s;
}
button:hover{transform:scale(1.05)}

.center{
 min-height:100vh;
 display:flex;
 align-items:center;
 justify-content:center;
}

.box{
 background:var(--card);
 padding:30px;
 border-radius:22px;
 width:380px;
 box-shadow:0 25px 60px rgba(0,0,0,.45);
}

.hidden{display:none}

header{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-bottom:20px;
}

.card{
 background:var(--card);
 padding:20px;
 border-radius:20px;
 margin-bottom:20px;
 box-shadow:0 15px 35px rgba(0,0,0,.25);
 transition:.3s;
}
.card:hover{transform:translateY(-6px)}

.lead{
 background:#fff;
 color:#000;
 padding:15px;
 border-radius:15px;
 margin-bottom:10px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
 <div class="box">
  <h2>Login</h2>
  <input id="user" placeholder="Usu√°rio">
  <input id="pass" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
 </div>
</div>

<!-- AMBIENTES -->
<div id="envs" class="center hidden">
 <div class="box">
  <h2>Ambientes</h2>
  <button onclick="openEnv('Modelle')">üíÉ Modelle Skin</button>
  <button onclick="openEnv('Cia')">üìì Cia & Arte</button>
  <button onclick="openEnv('Thalles')">üí® Thalles Climatiza√ß√£o</button>
 </div>
</div>

<!-- DASHBOARD -->
<div id="dash" class="hidden" style="padding:20px">
 <header>
  <h2 id="envTitle"></h2>
  <button onclick="back()">Voltar</button>
 </header>

 <div class="card">
  <h3>Novo Pedido</h3>
  <input id="desc" placeholder="Descri√ß√£o">
  <input id="valor" type="number" placeholder="Valor do produto">

  <div id="custos">
   <input id="custo" type="number" placeholder="Custo do produto">
   <input id="ordinario" type="number" placeholder="Custos ordin√°rios">
  </div>

  <button onclick="addPedido()">Adicionar Pedido</button>
 </div>

 <div class="card">
  <button onclick="downloadCSV()">‚¨áÔ∏è Baixar CSV</button>
 </div>

 <div id="lista"></div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycby0k9Gi5PzBlGc3eeNcilGVYOiZUcKDX7OqhSFNOHfeQKJZ0D_qozWelrk5Xne9Spc3/exec";

let env="", userAtual="";

function login(){
 userAtual=user.value;
 loginDiv.classList.add("hidden");
 envs.classList.remove("hidden");
}

function openEnv(e){
 env=e;
 envs.classList.add("hidden");
 dash.classList.remove("hidden");
 envTitle.innerText=e;

 custos.style.display=(env==="Modelle")?"none":"block";
 loadPedidos();
}

function back(){
 dash.classList.add("hidden");
 envs.classList.remove("hidden");
}

async function addPedido(){
 let payload={
  env,
  usuario:userAtual,
  desc:desc.value,
  valor:+valor.value,
  custo:+custo.value||0,
  ordinario:+ordinario.value||0
 };

 await fetch(API_URL,{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(payload)
 });

 desc.value=valor.value=custo.value=ordinario.value="";
 loadPedidos();
}

async function loadPedidos(){
 lista.innerHTML="";
 const r=await fetch(`${API_URL}?env=${env}&user=${userAtual}`);
 const data=await r.json();

 data.forEach(p=>{
  lista.innerHTML+=`
   <div class="lead">
    <b>${p.desc}</b><br>
    Valor: R$ ${p.valor}<br>
    ${env!=="Modelle"?
     `Custo: R$ ${p.custo}<br>
      Ordin√°rios: R$ ${p.ordinario}<br>
      <b>Lucro: R$ ${p.lucro}</b>`:""}
   </div>`;
 });
}

async function downloadCSV(){
 window.open(`${API_URL}?csv=1&env=${env}`);
}
</script>

</body>
</html>
